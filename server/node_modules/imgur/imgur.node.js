!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(global,(function(){return(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ImgurClient:()=>f,default:()=>m,getAuthorizationHeader:()=>n});const r=require("tslib"),i=require("events"),a="https://api.imgur.com";function n(e){return(0,r.__awaiter)(this,void 0,void 0,(function*(){if(void 0!==e.credentials.accessToken)return`Bearer ${e.credentials.accessToken}`;const{clientId:t,clientSecret:r,refreshToken:i}=e.credentials;if(void 0!==e.credentials.refreshToken){const n={url:"oauth2/token",baseURL:a,method:"POST",data:{client_id:t,client_secret:r,refresh_token:i,grant_type:"refresh_token"}},o=yield e.plainRequest(n);if(200===o.status&&o.data){const{access_token:t,refresh_token:r}=o.data;return e.credentials.accessToken=t,e.credentials.refreshToken=r,`Bearer ${t}`}}return function(e){return void 0!==e.clientId}(e.credentials)?`Client-ID ${t}`:null}))}const o=require("form-data");var s=e.n(o);function d(e){const t=new(s());if("string"==typeof e)return t.append("image",e),t;for(const[r,i]of Object.entries(e)){const a=["base64","stream"];-1!==a.indexOf(r)?-1!==a.indexOf(e.type)&&t.append(r,e):i&&t.append(r,i)}return t.getHeaders=t.getHeaders?t.getHeaders:()=>({"Content-Type":"multipart/form-data"}),t}function u(e){var t,r,i,a,n,o,s,d,u,c;let l,p=!0,h=200;const v=e&&(void 0!==e.status||void 0!==(null===(t=e.data)||void 0===t?void 0:t.status))&&void 0!==e.data,f=v&&!!e.data.success,m=v&&!f&&(void 0!==(null===(r=e.data.data)||void 0===r?void 0:r.error)||void 0!==e.data.errors);var g;return void 0===e?(l="response was empty",h=500,p=!1):"string"==typeof e?(l=e,h=500,p=!1):f?(h=e.data.status,l=e.data.data.error?e.data.data.error:e.data.data):(p=!1,h=null!==(o=null!==(n=null===(a=null===(i=e.data.data)||void 0===i?void 0:i.error)||void 0===a?void 0:a.code)&&void 0!==n?n:e.status)&&void 0!==o?o:e.data.status,g=m?null!==(d=null!==(s=e.data.errors)&&void 0!==s?s:e.data.data.error.message)&&void 0!==d?d:e.data.data.error:null!==(c=null!==(u=e.data.data)&&void 0!==u?u:e.data.message)&&void 0!==c?c:e.data,l=Array.isArray(g)?g.map((e=>m?e.detail:e.data)):g),{data:l,status:h,success:p}}const c=require("url"),l={section:"hot",sort:"viral"};const p=["q_all","q_any","q_exactly","q_not","q_type","q_size_px"];const h=require("axios");var v=e.n(h);class f extends i.EventEmitter{constructor(e){var t,i,o;super(),this.credentials=e,this.credentials.rapidApiHost=(null===(t=e.rapidApiKey)||void 0===t?void 0:t.length)?null!==(i=e.rapidApiHost)&&void 0!==i?i:"imgur-apiv3.p.rapidapi.com":e.rapidApiHost;const s="undefined"!=typeof window?{}:{"user-agent":"imgur (https://github.com/keneucker/imgur)"};this.plainFetcher=v().create({baseURL:a,headers:s,responseType:"json"}),this.fetcher=v().create({baseURL:(null===(o=e.rapidApiKey)||void 0===o?void 0:o.length)?`https://${this.credentials.rapidApiHost}`:a,headers:s,responseType:"json"}),this.fetcher.interceptors.request.use((t=>(0,r.__awaiter)(this,void 0,void 0,(function*(){var r;return t.headers=t.headers?t.headers:{},t.headers.authorization=yield n(this),(null===(r=e.rapidApiKey)||void 0===r?void 0:r.length)&&(t.headers["x-rapidapi-host"]=e.rapidApiHost,t.headers["x-rapidapi-key"]=e.rapidApiKey),t}))),(e=>Promise.reject(e)))}plainRequest(e){return this.plainFetcher(e)}request(e={}){return this.fetcher(e)}deleteImage(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/image/${t}`;return u(yield e.request({url:r,method:"DELETE"}).catch((e=>e.response)))}))}(this,e)}favoriteImage(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/image/${t}/favorite`;return u(yield e.request({url:r,method:"POST"}).catch((e=>e.response)))}))}(this,e)}getAlbum(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/album/${t}`;return u(yield e.request({url:r}).catch((e=>e.response)))}))}(this,e)}getAccount(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/account/${t}`;return u(yield e.plainRequest({url:r}).catch((e=>e.response)))}))}(this,e)}getAlbums(e,t){return function(e,t,i){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/account/${t}/albums/${null!=i?i:""}`;return u(yield e.request({url:r}).catch((e=>e.response)))}))}(this,e,t)}createAlbum(e,t){return function(e,t,i){var a,n;return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=d({title:t,description:i}),o=yield e.request({url:"3/album",headers:r.getHeaders(),method:"POST",data:r}).catch((e=>e.response));return(null===(a=o.data)||void 0===a?void 0:a.success)&&(null===(n=o.data)||void 0===n?void 0:n.data)&&(o.data.data.title=t,o.data.data.description=i),u(o)}))}(this,e,t)}getAlbumsIds(e,t){return function(e,t,i){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/account/${t}/albums/ids/${null!=i?i:""}`;return u(yield e.request({url:r}).catch((e=>e.response)))}))}(this,e,t)}getGallery(e){return function(e,t=l){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const{pathname:r}=function(e){const t=Object.assign({},l,e);let r=`${t.section}`;t.sort&&(r+=`/${t.sort}`),"top"===t.section&&t.window&&(r+=`/${t.window}`),t.page&&(r+=`/${t.page}`);const i=new c.URL(`${a}/3/gallery/${r}`);return void 0!==t.showViral&&i.searchParams.append("showViral",t.showViral.toString()),void 0!==t.mature&&i.searchParams.append("mature",t.mature.toString()),void 0!==t.album_previews&&i.searchParams.append("album_previews",t.album_previews.toString()),i}(t),i=r.slice(1);return u(yield e.request({url:i}).catch((e=>e.response)))}))}(this,e)}getSubredditGallery(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const{pathname:r}=function(e){let t=`${e.subreddit}`;return e.sort&&(t+=`/${e.sort}`),"top"===e.sort&&e.window&&(t+=`/${e.window}`),e.page&&(t+=`/${e.page}`),new c.URL(`${a}/3/gallery/r/${t}`)}(t),i=r.slice(1);return u(yield e.request({url:i}).catch((e=>e.response)))}))}(this,e)}searchGallery(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const{pathname:r}=function(e){let t="";e.sort&&(t+=`/${e.sort}`),"top"===e.sort&&e.window&&(t+=`/${e.window}`),e.page&&(t+=`/${e.page}`);const r=new c.URL(`${a}/3/gallery/search${t}`);if(p.forEach((t=>{var i;(null===(i=e[t])||void 0===i?void 0:i.length)&&r.searchParams.append(t,e[t])})),!r.search){const t=e.q||e.query;if(!t)throw new Error("No query was provided");r.searchParams.append("q",t)}return r}(t),i=r.slice(1);return u(yield e.request({url:i}).catch((e=>e.response)))}))}(this,e)}getImage(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=`3/image/${t}`;return u(yield e.request({url:r}).catch((e=>e.response)))}))}(this,e)}updateImage(e){return function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function*(){if("string"!=typeof(i=t).title&&"string"!=typeof i.description)throw new Error("Update requires a title and/or description");var i;const a=`3/image/${t.imageHash}`,n=d(t);return new Promise((t=>(0,r.__awaiter)(this,void 0,void 0,(function*(){return t(u(yield e.request({url:a,method:"POST",data:n,headers:n.getHeaders()}).catch((e=>e.response))))}))))}))}(this,e)}upload(e){return function(e,t){var i;return(0,r.__awaiter)(this,void 0,void 0,(function*(){const a=d(t),n=t.image,o="string"==typeof n?n:null!==(i=n.path)&&void 0!==i?i:n.name,s="stream"!==t.type||!o||-1===o.indexOf(".mp4")&&-1===o.indexOf(".avi")?"3/image":"3/upload";return new Promise((t=>(0,r.__awaiter)(this,void 0,void 0,(function*(){return t(u(yield e.request({url:s,method:"POST",data:a,headers:a.getHeaders(),onUploadProgress:t=>{e.emit("uploadProgress",Object.assign({},t))}}).catch((e=>e.response))))}))))}))}(this,e)}}const m=f;return t})()}));